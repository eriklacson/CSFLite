version: 1
defaults:
  confidence: Medium
  rationale_prefix: "rule:"
rules:
  - name: "Transport security (TLS/HSTS/Headers)"
    when: { any_tag: [ssl, tls, hsts, headers], min_severity: medium }
    map:  { csf_subcats: [PR.IR-01], confidence: High,
            rationale: "TLS config + secure transport signals" }

  - name: "Exposed backups & secrets"
    when: { any_tag: [backup, exposure, secret, s3, cloud, git, env, token] }
    map:  { csf_subcats: [PR.DS-01], confidence: High,
            rationale: "At-rest/backup exposure indicates inventory & protection gaps" }

  - name: "Default creds / open admin"
    when: { any_tag: [default-login, auth, admin-panel], min_severity: medium }
    map:  { csf_subcats: [PR.AA-01, PR.AA-03],
            rationale: "IAM/auth/access-control discipline issues" }

  - name: "Known-vuln sweeps (CVEs & stacks)"
    when: { any_tag: [cve, wordpress, confluence, jira, gitlab, jenkins, grafana, kibana, drupal, magento], min_severity: high }
    map:  { csf_subcats: [PR.PS-01],
            rationale: "Patch maintenance, vuln identification, runtime watch" }

  - name: "Change/drift signals"
    when: { any_tag: [exposure, directory-listing, backup, env, git, misconfig], min_severity: medium }
    map:  { csf_subcats: [PR.PS-01, DE.CM-01], rationale: "Runtime + network-level drift signals" }

  - name: "Fingerprinting & service discovery (inventory/flows)"
    when: { any_tag: [tech, cloud, network, discovery, port], min_severity: info }
    map:  { csf_subcats: [ID.AM-02, ID.AM-03], rationale: "External discovery informs inventory and flows" }

  - name: "Baseline config hygiene (misconfig/CORS/headers)"
    when: { any_tag: [misconfig, headers, cors], min_severity: medium }
    map:  { csf_subcats: [PR.PS-01], confidence: High,
            rationale: "Configuration management signaled by header/CORS issues" }

  - name: "API/OpenAPI exposure posture"
    when: { any_tag: [api, openapi, auth, exposure, misconfig], min_severity: medium }
    map:  { csf_subcats: [ID.RA-01, PR.DS-01], confidence: Medium,
            rationale: "API spec + exposure informs risk prioritization and protections" }

  - name: "CVE feed as lightweight threat intel"
    when: { any_tag: [cve], min_severity: high }
    map:  { csf_subcats: [ID.RA-01], confidence: Low,
            rationale: "Templates encode CVE intel; full intel program is governance" }

  - name: "Adverse event analysis (correlation signal)"
    when: { any_tag: [cve, exposure, backup, secret, ssl, tls, headers], min_severity: medium }
    map:  { csf_subcats: [ID.RA-01], confidence: Low,
            rationale: "Findings feed analysis; formal investigation is response process" }

overrides:
  - template_id: networking/open-ports
    csf_subcats: [ID.AM-02, ID.AM-03, DE.CM-01]
    confidence: Medium
    rationale: "Open ports discovery evidences inventory/flows; cadence implies network monitoring"